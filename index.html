<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DEV.to User By ID</title>
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="https://stepzen.com/images/favicon/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="https://stepzen.com/images/favicon/favicon-16x16.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="https://stepzen.com/images/favicon/favicon-32x32.png"
    />
    <link
      href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <script
      src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js"
      defer
    ></script>
    <style>
      button:disabled {
          cursor: not-allowed;
          opacity: 0.5;
      }
    </style>
  </head>

  <body>
    <h1
      class="
        text-center text-3xl
        font-bold
        mt-24
        mb-6
        uppercase
        text-indigo-800
      "
    >
      DEV.to User By ID
    </h1>
    <div class="w-2/4 mx-auto" x-data="{ open: false}">
      <div x-show="open"></div>
      <form
        action="/"
        method="POST"
        class="w-2/4 mx-auto"
        x-data="idForm()"
        @submit.prevent="submitData"
      >
        <div class="mb-4">
          <label class="block mb-2 text-indigo-900">ID:</label>
          <input
            type="text"
            name="id"
            class="border w-full p-1"
            x-model="formData.id"
          />
        </div>

        <button
          class="
            bg-indigo-800
            hover:bg-gray-800
            disabled:opacity-50
            text-white
            w-full
            p-2
            mb-4
          "
          x-text="buttonLabel"
          :disabled="loading"
        ></button>

        <div class="max-w-sm rounded shadow-lg">
          <pre class="text-indigo-700 text-base">

    devto_getUser(id: <span x-text="formData.id"></span>) {
        username
        github_username
        id
        joined_at
        location
        name
        type_of
        website_url
        articles {
          canonical_url
        }
        }
      
            </pre>
        </div>
        <div>
          <div class="max-w-sm rounded shadow-lg p-2 m-2 text-indigo-900">
            Response:
            <pre class="p-2"><span x-text="message"></span></pre>
          </div>
        </div>
        <div>
          <div
            class="
              max-w-sm
              rounded
              shadow-lg
              m-2
              p-2
              overflow-scroll
              text-indigo-900
            "
          >
            Articles:
            <pre><span x-text="articles"></span></pre>
          </div>
        </div>
      </form>
    </div>
    <script>
      function idForm() {
        return {
          formData: {
            id: '',
          },
          message: '',
          articles: '',
          loading: false,
          buttonLabel: 'Submit',

          submitData() {
            this.buttonLabel = 'Submitting...'
            this.loading = true
            this.message = ''
            const body = JSON.stringify({
              operationName: 'MyQuery',
              query: `query MyQuery($id: String!) {
                          devto_getUser(id: $id) {
                            username
                            github_username
                            id
                            joined_at
                            location
                            name
                            type_of
                            website_url
                                    articles {
            canonical_url
            title
          }
                          }
                        }`,
              variables: {
                id: this.formData.id,
              },
            })

            console.log('BODY', body)
            fetch('https://mojave.stepzen.net/testing/netlifybuild/__graphql', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: body,
            })
              .then(
                (response) => response.json(),
                console.log('BODY AFTER FETCH', body)
              )
              .then((data) => {
                console.log('DATA AFTER FETCH', data.data.devto_getUser)
                let message_massage = `
      Username: ${data.data.devto_getUser.username}
      Joined at: ${data.data.devto_getUser.joined_at}
      Location: ${data.data.devto_getUser.location}
                                  `
                this.message = message_massage
                this.articles = `
  1. ${data.data.devto_getUser.articles[0].title} 
  2. ${data.data.devto_getUser.articles[1].title}
  3. ${data.data.devto_getUser.articles[2].title}`
              })
              .catch((err) => {
                console.log(err)
                this.message = 'Ooops! Something went wrong!'
              })
              .finally(() => {
                this.loading = false
                this.buttonLabel = 'Submit'
              })
          },
        }
      }
    </script>
  </body>
</html>

<!-- query MyQuery {
  devto_getArticles(username: "ben", top: 10) {
    url
  }
} -->
